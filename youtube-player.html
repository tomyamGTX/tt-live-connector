<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Player</title>
  <style>
    html, body {
      margin: 0; 
      padding: 0; 
      height: 100%; 
      background: black;
      overflow: hidden;
      display: flex; 
      justify-content: center; 
      align-items: center;
    }
    #player {
      width: 100%;
      height: 100%;
      max-width: 480px;
      max-height: 270px; /* 16:9 aspect ratio */
    }
  </style>
</head>
<body>
  <div id="player"></div>

  <script>
    // Parse URL params
    const params = new URLSearchParams(window.location.search);
    const videoId = params.get('v');
    const duration = parseInt(params.get('dur'), 10) || 0;

    if (!videoId) {
      document.body.innerHTML = '<p style="color:white;">No video ID provided.</p>';
    } else {
      // Load YouTube IFrame Player API script
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.head.appendChild(tag);

      let player;

      // YouTube API ready callback
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          videoId: videoId,
          playerVars: {
            autoplay: 1,
            controls: 1,
            modestbranding: 1,
            rel: 0,
            showinfo: 0,
            iv_load_policy: 3,
            fs: 0,
            origin: window.location.origin,
          },
          events: {
            onReady: (event) => {
              event.target.playVideo();
              if (duration > 0) {
                setTimeout(() => {
                  event.target.stopVideo();
                  window.close();  // Auto-close after duration ends
                }, duration * 1000);
              }
            },
            onStateChange: (event) => {
              // Optional: close window when video ends
              if (event.data === YT.PlayerState.ENDED) {
                window.close();
              }
            }
          }
        });
      }

      // Attach API ready to window (required by YouTube API)
      window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
    }
  </script>
</body>
</html>
